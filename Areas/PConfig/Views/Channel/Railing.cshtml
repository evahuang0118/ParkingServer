@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>柵欄機/車位擋板開關控制</title>
    <link href="~/Content/layui/css/layui.css" rel="stylesheet" />
    <link href="~/Content/framework/css/console.css" rel="stylesheet" />
    <link href="~/Content/framework/css/animate.css" rel="stylesheet" />
    <link href="~/Content/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <script src="~/Content/jquery/jquery.min.js"></script>
    <script src="~/Content/layui/layui.js"></script>
    <script src="~/Content/framework/js/global.js"></script>
    <script src="~/Content/framework/js/com.js"></script>
    <style>
        .layui-table-cell {
            height: 44px !important;
            line-height: 28px;
            padding: 8px 15px;
            position: relative;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
	<div class="panel animated fadeIn">
		<div class="panel-body">

			<div class="layui-row">

				<div class="layui-col-md12">

					<table class="layui-table" id="gridList" lay-filter="gridList" style="margin-top:-20px;"></table>

				</div>

				<script id="barDemoOpenClose" type="text/html">

					<div class="layui-input-wrap">

						<button type="button" class="layui-btn layui-btn-sm" lay-event="open"><i class="fa fa-arrow-circle-up"></i>  開  閘</button>

						<button type="button" class="layui-btn layui-btn-sm layui-btn-danger" lay-event="close"><i class="fa fa-arrow-circle-down"></i>  關  閘</button>
					</div>

				</script>


					@* <div id="streamURL"> *@
						@* <div class="url-input">
							<label for="sURL">Stream URL:</label>
							<input id="sURL" type="text" value="http://127.0.0.1:8080/live/livestream.flv" />
							<button onclick="switch_mds()">Switch to MediaDataSource</button>
						</div> *@
						@* <div class="options">
							<input type="checkbox" id="isLive" onchange="saveSettings()" checked />
							<label for="isLive">isLive</label>
							<input type="checkbox" id="withCredentials" onchange="saveSettings()" />
							<label for="withCredentials">withCredentials</label>
							<input type="checkbox" id="hasAudio" onchange="saveSettings()"/>
							<label for="hasAudio">hasAudio</label>
							<input type="checkbox" id="hasVideo" onchange="saveSettings()" checked />
							<label for="hasVideo">hasVideo</label>
						</div> *@
					@* </div> *@


						@* <div id = 'video-container' class="video-container layui-row layui-col-space15"> *@
							@* <div class="layui-col-md6">
								<div class="layui-panel">
									<div style="padding: 30px;">
										<video name="videoElement" class="centeredVideo" controls autoplay>
											Your browser is too old which doesn't support HTML5 video.
										</video>
									</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-panel">
									<div style="padding: 30px;">
										<video name="videoElement2" class="centeredVideo" controls autoplay>
											Your browser is too old which doesn't support HTML5 video.
										</video>
									</div>
								</div>
							</div> *@
						@* </div> *@
					@* <div class="controls">
						<button onclick="flv_load()">Load</button>
						<button onclick="flv_start()">Start</button>
						<button onclick="flv_pause()">Pause</button>
						<button onclick="flv_destroy()">Destroy</button>
						<input style="width:100px" type="text" name="seekpoint" />
						<button onclick="flv_seekto()">SeekTo</button>
					</div> *@

			</div>

		</div>
	</div>
	<script src="~/Content/layui/layui.js" charset="utf-8"></script>
	<script src="~/Content/layui/layui.all.js"></script>
	<script src="~/Content/stream/flv.js"></script>
	<script src="~/Content/stream/stream.js"></script>
</body>
</html>

<script type="text/javascript">
    layui.config({
        base: parent._baseUrl
    }).use(['jquery', 'form', 'layer', 'laydate'], function () {
        var layer = layui.layer;
        var form = layui.form;
    });

    layui.use(['form', 'table'], function () {
        var form = layui.form,
            table = layui.table;

        function initGrid() {
					
						var x = window.matchMedia("(max-width: 768px)")
						
						console.log(`x.matches => ${x.matches}`)
					
						var cols = [[
							 { field: 'Id', title: 'ID', hide: true },
							 { fixed: '', title: '操 作', align: 'left', toolbar: '#barDemoOpenClose', width: x.matches ? '60%' : '30%' },
							 x.matches ? null : {
									 field: 'State', title: "狀 態", align: 'left',
									 templet: function (d) {
											 if (d.State ==1)
													 return "有車" + " / " + d.Other;
											 if (d.State ==2)
													 return "無車" + " / " + d.Other;
											 else
													 return "/ " + d.Other;
									 }
							 } ,
							 { field: 'ChannelName', align: 'left', title: '車道名稱', style: 'color:blue;height:60px', }
						 ]]
					
            table.render({
                elem: '#gridList',
                url: '/PConfig/Channel/GIndex',
                method: 'post',
                cellMinWidth: 80,
                cols: cols,
                limit: 50,
                page: false,
                done: function (res, curr, count) {
                    if (res.data == null || res.data.length == 0) {
                        $('.layui-table-total').css({ display: "none" })
                    }
                }
            });
        }

        initGrid();

        table.on('tool(gridList)', function (obj) {
            var data = obj.data;
            var id = data.Id
            if (obj.event === 'open') {
                $.layerConfirm({
                    content: "您確定要進行此操作嗎？",
                    callback: function () {
                        $.formSubmit({
                            url: '/PConfig/Channel/RailingOpenClose', //開閘
                            data: { id: id, type: 1 },
                            success: function (data) {
                                if (data.state != 1) {
                                    if (data.message == null) {
                                        layer.msg(data.msg);
                                    }
                                }
                                else
                                    layer.msg("命令已發送！");
                            }
                        });
                    }
                });
            }
            else if (obj.event === 'close') {
                $.layerConfirm({
                    content: "請確認欄柵欄下面無任何障礙物！",
                    callback: function () {
                        $.formSubmit({
                            url: '/PConfig/Channel/RailingOpenClose', //落杆
                            data: { id: id, type: 2 },
                            success: function (data) {
                                if (data.state != 1) {
                                    if (data.message == null) {
                                        layer.msg(data.msg);
                                    }
                                }
                            }
                        });
                    }
                });
            }
        });


				@* add by stevn, 2023-08-29 *@
				@* getStreamURL(); *@
        form.render();
    });


    @* add by steven, 2023-08-29 *@

</script>

