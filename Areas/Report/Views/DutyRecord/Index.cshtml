@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>值班记录报表</title>
    <link href="~/Content/layui/css/layui.css" rel="stylesheet" />
    <link href="~/Content/framework/css/console.css" rel="stylesheet" />
    <link href="~/Content/framework/css/animate.css" rel="stylesheet" />
    <link href="~/Content/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <script src="~/Content/jquery/jquery.min.js"></script>
    <script src="~/Content/layui/layui.js"></script>
    <script src="~/Content/framework/js/global.js"></script>
    <script src="~/Content/framework/js/com.js"></script>
    <style type="text/css">
        .layui-table-cell {
            height: auto !important;
            white-space: normal;
        }
    </style>
</head>

<body>
    <div class="panel animated fadeIn">
        <div class="panel-body">
            <fieldset class="layui-elem-field layuimini-search">
                <legend>搜索信息</legend>
                <div style="margin: 5px 5px 5px 5px">
                    <div class="layui-form layui-form-pane">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label" style="width:120px">換班時段範圍</label>
                                <div class="layui-input-inline">
                                    <input class="layui-input" id="HBtime" name="HBtime" placeholder="" autocomplete="off" />
                                </div>
                                <div class="layui-input-inline">
                                    <input class="layui-input" id="HEtime" name="HEtime" placeholder="" autocomplete="off" />
                                </div>
                            </div>

                            <div class="layui-inline">
                                <label class="layui-form-label">值班人員</label>
                                <div class="layui-input-inline">
                                    <input type="text" id="DutyName" autocomplete="off" class="layui-input">
                                </div>
                            </div>

                            <div class="layui-inline">
                                <label class="layui-form-label" style="width:120px">交班時段範圍</label>
                                <div class="layui-input-inline">
                                    <input class="layui-input" id="Btime" name="Btime" placeholder="" autocomplete="off" />
                                </div>
                                <div class="layui-input-inline">
                                    <input class="layui-input" id="Etime" name="Etime" placeholder="" autocomplete="off" />
                                </div>
                            </div>


                            <div class="layui-inline">
                                <button id="btnSearch" class="toolbar-search-button layui-btn layui-btn-normal layui-btn-small">
                                    <i class="layui-icon">&#xe615;</i>搜 索
                                </button>
                            </div>

                        </div>
                    </div>
                </div>
            </fieldset>

            <div id="toolbar" class="elight-table-toolbar">
                    <div class="layui-btn-group"></div>
                </div>

            <div class="layui-row layui-col-space15">
                <div class="layui-col-md8">
                    <fieldset class="layui-elem-field layui-field-title" style="margin-top:2px;">
                        <legend><span style="font-size:14px;color:midnightblue">匯總資料</span></legend>
                    </fieldset>
                    <table class="layui-hide" id="gridList" lay-filter="gridList"></table>

                    <script type="text/html" id="LogType">
                        {{#  if(d.LogType=='1'){ }}
                        崗亭交班
                        {{#  }else{ }}
                        中央交班
                        {{# } }}
                    </script>

                    <script id="barDemo" type="text/html">
                        <a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
                    </script>


                </div>

                <div class="layui-col-md4">
                    <fieldset class="layui-elem-field layui-field-title" style="margin-top:2px;">
                        <legend><span style="font-size:14px;color:blue">明細記錄</span></legend>
                    </fieldset>
                    <table class="layui-hide" id="gridLists" lay-filter="gridLists"></table>
                </div>


            </div>

            <div class="layui-row layui-col-space15">
                <div class="layui-col-md5">
                    <fieldset class="layui-elem-field layui-field-title" style="margin-top:2px;">
                        <legend><span style="font-size:14px;color:blue;">報表說明</span></legend>
                    </fieldset>
                    <div layui-collapse>
                        <p style="color:currentColor">
                            1. 此報表展示的是收費操作人員每天在當班時段內的收費操作情況
                            <br>
                            2. 此報表的生成需要收費操作人員在收費客戶端進行交接班操作,否則系統無法生成此報表
                            <br />
                            3. 應收金額,實收金額是指操作人員在當班時間段所收取的現金金額,並不包括行動支付金額
                            <br />
                            4. 此報表可以當作考核收費操作人員的一個依據
                            <br />
                            5. 詳細信息「 是根據操作人員從換班時間到交班時間這段時間內,所操作的收費記錄訊息。

</div>
                </div>


            </div>
        </div>
    </div>
    <script src="~/Content/layui/layui.js" charset="utf-8"></script>
    <script src="~/Content/layui/layui.all.js"></script>
    <script src="~/Content/layui_exts/excel.js"></script>
</body>
</html>

<script type="text/javascript">
    layui.config({
        base: parent._baseUrl
    }).use(['jquery', 'form', 'layer', 'laydate'], function () {
        var layer = layui.layer;
        var form = layui.form;
        var laydate = layui.laydate;

        laydate.render({
            elem: "#Etime"
            , type: 'datetime'

        });

        laydate.render({
            elem: "#Btime"
            , type: 'datetime'

        });

        laydate.render({
            elem: "#HEtime"
            , type: 'datetime'

        });

        laydate.render({
            elem: "#HBtime"
            , type: 'datetime'

        });

        $("#toolbar").authorizeButton();
    });

    layui.use(['form', 'table'], function () {
        var form = layui.form,
            table = layui.table;

        function initGrid() {
            table.render({
                elem: '#gridList',
                url: '/Report/DutyRecord/Index',
                where: {
                    Btime: $("#Btime").val(),
                    Etime: $("#Etime").val(),
                    DutyName: $("#DutyName").val(),
                    HBtime: $("#HBtime").val(),
                    HEtime: $("#HEtime").val()
                },
                method: 'post',
                cellMinWidth: 80,
                height: 'full-180',
                totalRow: true,
                cols: [[

                    { field: 'Id', title: 'Id', hide: true },
                    {
                        width: 60, style: 'color:blue', fixed: 'left',
                        templet: function (res) {
                            return '<a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>';
                        }
                    },
                    { field: 'DutyName', width: 90, title: '值班人員', style: 'color:blue', totalRowText: '合計', fixed: 'left' },
                    { field: 'Btime', width: 170, title: '接班時間', sort: true, fixed: 'left' },
                    { field: 'Etime', width: 170, title: '交班時間', sort: true, fixed: 'left' },
                    { field: 'Payment', width: 90, title: '應收現金', totalRow: true, style: 'color:midnightblue;text-align:right', templet: function (d) { return Number(d.Payment).toFixed(0); } },
                    { field: 'Actual', width: 90, title: '實收現金', totalRow: true, style: 'color:blue;text-align:right', templet: function (d) { return Number(d.Actual).toFixed(0); } },
                    { field: 'PreferentialMoney', width: 90, title: '優惠金額', totalRow: true, style: 'color:blue;text-align:right', templet: function (d) { return Number(d.PreferentialMoney).toFixed(0); } },
                    { field: 'FreeMoney', width: 90, title: '免費金額', totalRow: true, style: 'color:blue;text-align:right', templet: function (d) { return Number(d.FreeMoney).toFixed(0); } },
                    { field: 'CNum', width: 98, title: '車次(筆)數', totalRow: true, style: 'color:midnightblue;' },
                    { field: 'DutyTime', width: 170, title: '操作時間' },
                    { field: 'LogType', width: 90, title: '操作類型', templet: '#LogType', width: 95 },
                    { field: 'Describe', title: '備註', width: 450, },
                ]],
                limits: [30, 50, 80, 100, 150, 200],
                limit:30,
                page: true,
                done: function (res, curr, count) {
                    if (res.data == null || res.data.length == 0) {
                        $('.layui-table-total').css({ display: "none" })

                    }
                }
            });
        }

        initGrid();

        $('#btnSearch').on("click", function () {
            initGrid();
        });

        table.on('tool(gridList)', function (obj) {
            var data = obj.data;
            if (obj.event === 'detail') {

                table.render({
                    elem: '#gridLists',
                    url: '/Report/ChargeRecord/Index',
                    where: {
                        PayType: "-1",
                        Btime: data.Btime,
                        Etime: data.Etime,
                        plateNo: "",
                        userName: data.DutyName,
                        FreeType: data.LogType,
                        OrderNo: "",
                        EquipmentNo: "0",
                        PayCash: "0",
                        FreePreferential: "0",
                        TimeNum: "0",
                        OType:"0",
                        OrgId:""
                    },
                    method: 'post',
                    cellMinWidth: 80,
                    height: 'full-180',
                    totalRow: true,
                    cols: [[
                        { field: 'CreateName', width: 80, title: '操作人', style: 'color:red', fixed: 'left' },
                        { field: 'PlateNo', width: 110, title: '車牌號碼', style: 'color:blue', totalRowText: '合计', fixed: 'left' },
                        { field: 'PayAmount', width: 80, title: '金 額',fixed: 'left' , totalRow: true, style: 'color:blue;text-align:right', templet: function (d) { return Number(d.PayAmount).toFixed(0); } },
                        { field: 'PayName', width: 110, title: '支付方式', style: 'color:blue', sort: true },
                        { field: 'InTime', width: 170, title: '入場時間', sort: true },
                        { field: 'OutTime', width: 170, title: '出場時間', sort: true },
                        { field: 'CreateTime', width: 170, title: "操作時間", sort: true },
                        { field: 'FreeName', width: 200, title: "折扣類型" },
                    ]],
                    limits: [30, 50, 80, 100, 150, 200],
                    limit: 100,
                    page: true,
                    done: function (res, curr, count) {
                        if (res.data == null || res.data.length == 0) {
                            $('.layui-table-total').css({ display: "none" })

                        }
                    }
                });
            }
        });

    });

    function btn_Excel() {
        layui.use(['layer'], function () {
            var $ = layui.jquery
            var layer = layui.layer
            var excel = layui.excel
            $.ajax({
                url: '/Report/DutyRecord/Export'
                , dataType: 'json'
                , success: function (res) {
                    var data = res.data
                    data = excel.filterExportData(data, {
                        DutyName: 'DutyName'
                        , Btime: 'Btime'
                        , Etime: 'Etime'
                        , Payment: 'Payment'
                        , Actual: 'Actual'
                        , PreferentialMoney: 'PreferentialMoney'
                        , FreeMoney: 'FreeMoney'
                        , CNum: 'CNum'
                        , DutyTime: 'DutyTime'
                        , Describe: 'Describe'
                    })
                    data.unshift({
                        DutyName: "值班人員",
                        Btime: "接班時間",
                        Etime: '交班時間',
                        Payment: "應收現金",
                        Actual: "實收現金",
                        PreferentialMoney: "優惠金額",
                        FreeMoney: '免費金額',
                        CNum: "車次(筆)數",
                        DutyTime: "操作時間",
                        Describe: "備註"
                    });
                    top.LAY_EXCEL.exportExcel({
                        sheet1: data
                    }, '值班資料記錄表_' + getDateTime() + '.xlsx', 'xlsx')
                }
                , error: function () {
                    layer.alert('獲取數據失败!!!')
                }
            })
        })
    }

    function btn_PDF() {
        window.location.href = "/Report/DutyRecord/DutyRecordPDF"
    }

</script>